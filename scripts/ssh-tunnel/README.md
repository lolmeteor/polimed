# Настройка SSH-туннеля для МИС API

Этот инструмент позволяет настроить SSH-туннель для доступа к МИС API через защищенное соединение.

## Требования

- Node.js версии 14 или выше
- SSH клиент, установленный в системе
- Доступ к виртуальной машине 51.250.34.77

## Использование

1. Запустите скрипт из корневой директории проекта:

```bash
node scripts/ssh-tunnel/setup-tunnel.js
```

2. Скрипт создаст SSH-туннель, который перенаправит http://localhost:9095 на удаленный сервер МИС API.

3. После запуска туннеля МИС API будет доступен локально по адресу:

```
http://localhost:9095/HubService.svc
```

4. Для завершения работы туннеля нажмите Ctrl+C.

## Как это работает

1. Скрипт создает временный файл с SSH-ключом из файла cursorinfo/id_rsa
2. Запускает SSH-клиент для создания туннеля
3. Перенаправляет порт 9095 с локального хоста на gw.chel.mnogomed.ru:9095
4. При завершении работы туннеля временный файл с ключом автоматически удаляется

## Настройка .env файла

Для корректной работы приложения с туннелем, установите следующие переменные окружения:

```
MIS_WSDL_URL=http://localhost:9095/HubService.svc?singleWsdl
MIS_TOKEN_URL=http://localhost:9095/api/token
MIS_GUID=5aa5aa80-24ed-44b0-8f64-3e71253069b1
```

## Возможные проблемы

### Проблема с доступом к файлу ключа

Если возникает ошибка доступа к файлу ключа, убедитесь, что файл имеет правильные права доступа (600).

### Туннель закрывается с ошибкой

Проверьте доступность сервера 51.250.34.77 и правильность учетных данных SSH.

### МИС API не отвечает через туннель

Убедитесь, что:
1. SSH-туннель запущен и работает без ошибок
2. Удаленный сервер gw.chel.mnogomed.ru доступен с машины 51.250.34.77
3. В конфигурации приложения используются правильные URL с localhost:9095 